<?php
$article = $this->pageCollectionItem;
$recentArticles = $this->recentPageCollectionItems;

$files = $article->getFiles();
$urls = array();

foreach ($files as $file) {
    if ($file->getType() !== \AlphaPage\Entity\PageCollectionItemFiles::ARTICLE_THUMB) {
        array_push($urls, $file->getFile());
    }
}

$recentUrls = array();
$i = 0;
foreach ($recentArticles as $recentArticle) {
    $files = $recentArticle->getFiles();
    foreach ($files as $file) {
        if ($file->getType() !== \AlphaPage\Entity\PageCollectionItemFiles::ARTICLE_THUMB) {
            $recentUrls[$i]["id"] = $file->getPageCollectionItem()->getId();
            $recentUrls[$i]["file"] = $file->getFile();
            $i++;
        }
    }
}

$imageCount = count($urls);

$date = new DateTime($article->getDate()->format('Y-m-d'));
$date = $date->format('F jS, Y');
$variables = array(
    'date' => $date,
    'url' => $article->getExternalUrl(),
);

//SETTING UP META-TAGS FOR FACEBOOK
$og_title = strtoupper($article->getTitle());
$og_description = 'Click here to read more about this article.';
$og_image = $urls[0];


//SENDING META-TAGS TO LAYOUT
$this->layout('layout/news-and-events-layout');
$this->layout()->setVariable('og_title', $og_title);
$this->layout()->setVariable('og_desc', $og_description);
$this->layout()->setVariable('og_image', $og_image);
?>
<!-- banner start -->
<!-- ================ -->
<div class="pv-40 banner light-gray-bg">
    <div class="container clearfix" >

        <div id="carousel-blog-post" class="carousel slide shadow" data-ride="carousel" >
            <!-- Indicators -->
            <ol class="carousel-indicators bottom margin-clear">

                <?php
                if ($imageCount > 1) {
                    for ($i = 0; $i < $imageCount; $i++) {
                        if ($i === 0) {
                            echo '<li data-target="#carousel-blog-post" data-slide-to="' . $i . '" class="active"></li>';
                        } else {
                            echo '<li data-target="#carousel-blog-post" data-slide-to="' . $i . '"></li>';
                        }
                    }
                }
                ?>
            </ol>

            <!-- Wrapper for slides -->
            <div class="carousel-inner" role="listbox">
                <?php
                for ($i = 0; $i < $imageCount; $i++) {
                    if ($i === 0) {
                        echo
                        '<div class="item active">
                                <div class="overlay-container">
                                    <img src="/files/' . $urls[$i] . '" alt="">
                                </div>
                            </div>';
                    } else {
                        echo
                        '<div class="item">
                                <div class="overlay-container">
                                    <img src="/files/' . $urls[$i] . '" alt="">
                                </div>
                            </div>';
                    }
                }
                ?>

                <!-- carousel controls -->
                <?php
                if ($imageCount > 1) {
                    echo '
                        <a class="carousel-control left" href="#carousel-blog-post" role="button" data-slide="prev">
                            <span class="glyphicon glyphicon-chevron-left"></span>
                        </a>
                        <a class="carousel-control right" href="#carousel-blog-post" role="button" data-slide="next">
                            <span class="glyphicon glyphicon-chevron-right"></span>
                        </a>';
                }
                ?>
            </div>
        </div>
    </div>
    <!-- banner end -->

    <!-- main-container start -->
    <!-- ================ -->
    <section class="main-container padding-ver-clear">
        <div class="container pv-40">
            <div class="row">

                <!-- main start -->
                <!-- ================ -->
                <div class="main col-md-8">
                    <h1 class="title"><?php echo $article->getTitle(); ?></h1>
                    <div class="separator-2"></div>
                    <p><?php echo $article->getDescription() ?></p>
                    <!--div style="margin:0 40px">
                        <p><i class="fa fa-quote-left"></i>The VC and GC Association have now gained a foothold in the digital age. This will allow access to valuable information for families and descendants of all past and present members.  In the future our website will allow access to the wealth of information available in Associationï¿½s Archive.<i class="fa fa-quote-right"></i></p>	
                        <footer><cite title="Source Title">Captain Sam Shephard GC RM</cite></footer>
                    </div-->
                </div>
                <!-- main end -->

                <!-- Sidebar -->
                <?php echo $this->partial('partial/sidebar/news-events.phtml', $variables); ?>
                <!-- Sidebar End -->
            </div>
        </div>
    </section>
    <!-- main-container end -->

    <?php if (count($recentArticles) > 1): ?>
        <section class="section pv-40 clearfix">
            <div class="container">
                <h2>Recent <?php echo ($article->getType() === 1) ? 'News' : 'Events'; ?></h2>
                <div class="separator-2"></div>
                <div class="row grid-space-10">
                    <?php foreach ($recentArticles as $recentArticle): ?>
                        <?php if ($recentArticle->getId() !== -1 && $recentArticle->getId() !== $article->getId()): ?>
                            <?php
                            $file = "";

                            for ($i = 0; $i < count($recentUrls); $i++) {
                                if ($recentUrls[$i]["id"] === $recentArticle->getId()) {
                                    $file = $recentUrls[$i]["file"];
                                }
                            }
                            ?>
                            <div class="col-sm-4">
                                <div class="image-box style-2 mb-20 bordered text-center">
                                    <div class="overlay-container">
                                        <img class="zoom-image" src="<?php echo '/files/' . $file ?>" alt="">
                                    </div>
                                    <div class="body shadow light-gray-bg ">
                                        <h3 style="text-overflow: ellipsis; white-space: nowrap; overflow: hidden;"><a href="<?php echo $this->url('news-and-events-article', ['param1' => $recentArticle->getId(), 'param2' => $this->clean_url_helper(strtolower($recentArticle->getTitle()))]); ?>"><?php echo $recentArticle->getTitle() ?></a></h3>
                                        <div class="separator"></div>
                                        <p style="text-align: left; text-overflow: ellipsis; white-space: nowrap; overflow: hidden;"><?php echo $recentArticle->getSmallDescription() ?></p>
                                        <a href="<?php echo $this->url('news-and-events-article', ['param1' => $recentArticle->getId(), 'param2' => $this->clean_url_helper(strtolower($recentArticle->getTitle()))]); ?>" class="btn btn-default btn-sm btn-hvr hvr-shutter-out-horizontal margin-clear">Read More<i class="fa fa-arrow-right pl-10"></i></a>												
                                    </div>
                                </div>
                            </div>
                        <?php endif ?>
                    <?php endforeach ?>
                </div>
            </div>
        </section>
    <?php endif ?>
</div>
